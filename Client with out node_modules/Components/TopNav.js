import { Menu } from 'antd';

import Link from 'next/link';   // to use link and navigate between pages

const { Item, SubMenu, ItemGroup } = Menu;     // to overwrite Menu.Item now we can use only item

import {
    LoginOutlined, UserAddOutlined, HomeFilled, WindowsFilled, LogoutOutlined, CoffeeOutlined,
    DashboardFilled, LaptopOutlined, CarryOutOutlined
} from '@ant-design/icons'   // importing icons
import { Context } from '../context';
import { useState, useEffect, useContext } from 'react';
import axios from 'axios';
import { useRouter } from 'next/router';
import { toast } from 'react-toastify'

const TopNav = () => {
    // adding state
    const [current, setCurrent] = useState("");

    const { state, dispatch } = useContext(Context);

    const { user } = state;

    const router = useRouter();
    useEffect(() => {
        process.browser && setCurrent(window.location.pathname)
    }, [process.browser && window.location.pathname])

    const logout = async () => {
        dispatch({ type: "LOGOUT" });
        window.localStorage.removeItem('user');
        const { data } = await axios.get("/api/logout");
        toast(data.message);
        router.push("/login");
    }


    return (
        <Menu mode="horizontal" selectedKeys={[current]}>
            <Item key="/" onClick={(e) => setCurrent(e.key)} icon={<HomeFilled />}>
                <Link href='\'>
                    <a>App</a>
                </Link>
            </Item>
            {user && user.role.includes("Instructor") ? (
                <Item key="/instructor/course/create" onClick={(e) => setCurrent(e.key)} icon={<CarryOutOutlined />}>
                    <Link href='/instructor/course/create'>
                        <a>Create Course</a>
                    </Link>
                </Item >
            ) : (
                <Item key="/user/become-instructor" onClick={(e) => setCurrent(e.key)} icon={<LaptopOutlined />}>
                    <Link href='/user/become-instructor'>
                        <a>Become an Instructor</a>
                    </Link>
                </Item >
            )}

            {user == null && (
                <>
                    <Item key="/login" onClick={(e) => setCurrent(e.key)} icon={<LoginOutlined />}>
                        <Link href='\login'>
                            <a>Login</a>
                        </Link>
                    </Item >
                    <Item key="/register" onClick={(e) => setCurrent(e.key)} icon={<UserAddOutlined />}>
                        <Link href='\register'>
                            <a>Register</a>
                        </Link>
                    </Item>
                </>
            )}

            {user != null && (
                <SubMenu icon={<CoffeeOutlined />} title={user && user.name} className="float-right">

                    <ItemGroup>
                        <Item key="/user" icon={<DashboardFilled />} >
                            <Link href="/user">
                                <a>DashBoard</a>
                            </Link>
                        </Item>
                        <Item onClick={logout} icon={<LogoutOutlined />} className="float-right">
                            Logout
                        </Item>

                    </ItemGroup>

                </SubMenu>
            )}


        </Menu>
    )
}
export default TopNav;